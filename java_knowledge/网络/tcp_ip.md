TCP/IP不是说TCP和IP两个协议的合称,而是指的整个TCP/IP协议族.
tcp ip协议模型与OSI模型有清晰的对应关系,
分为了四个层次:网络接口层,网络层,传输层,应用层

#### 一:网络接口层

​    TCP/IP并没有给出具体实现,只是指出了<span style='color:red'>主机</span>必须使用某种协议和<span style='color:red'>网络</span>相连

#### 二:网络层

​     是TCP/IP的协议栈的核心,网络层的主要功能是<span style='color:red'>寻址</span>(目标地址在哪里)和<span style='color:red'>路由</span>(该走那条链路).关键问题是确定数据包从源端到目的端.如何选择路由. 主要的协议有IP协议.

#### 三:传输层

​	让源端和目的端机器上的对等实体可以进行会话,**这一层定义了两个端到端的协议**.传输控制协议(TCP协议)和用户数据报协议(UDP协议).TCP协议是面向连接的协议,提供可靠的报文传输,UDP面向无连接的不可靠传输协议,主要用于不需要TCP的排序和流量控制等动能的应用程序.

### 四:应用层

​	负责处理特定的应用程序细节,应用层显示接受到的消息,把用户数据发给底层等,包含大量的应用程序,HTTP,ftp等.

![image-20200424112159081](/home/user/.config/Typora/typora-user-images/image-20200424112159081.png)===================================

相关知识

## 1:数据包

在协议中有5哥属于都是用来表述数据的单位:**包/帧/段/数据包/消息** 包:全能性术语

**帧:**数据链路层中包的单位

**数据包:**是网络层的包的单位

**段:**TCP数据流中的信息

**消息:**应用协议中数据的单位



在每一个分层中,都会给发送的数据附加一个头部信息,这个头部信息包含了该层要发送的**目标地址以及协议相关消息**.

![image-20200424112705565](/home/user/.config/Typora/typora-user-images/image-20200424112705565.png)

网络传输中数据包有两部分构成:一部分是协议要用到的头部,另一部分是上一层传过来的数据.



## 2 数据处理流程

下图以用户a向b发送邮件为例子

![image-20200424112913374](/home/user/.config/Typora/typora-user-images/image-20200424112913374.png)

**1)应用程序处理**

首先一应用程序进行编码处理

**2)TCP模块处理**

tcp根据应用的指示,负责建立连接,发送数据,断开连接(3次握手4次挥手),TCP将应用层发来的数据发动给对端的可靠传输,为了实现这一功能,添加一个TCP首部

**3)IP模块的管理**

IP将TCP传来的"TCP+数据"作为自己的数据,并且加上自己的ip首部,IP包生成后,参考路由控制表决定接受此IP包的路由或主机.

**4)网络接口的处理**

从IP传过来的IP包对于以太网来说就是数据,这些数据+以太首部并进行发送处理,生成的以太数据包将通过物理传输到接收端

**5)另一个机器网络接口的处理**

收到以太包后,首先从首部找到MAC地址判断是不是给自己的,不是就丢弃数据,是的话,就从首部继续确定数据类型,传给相应模块,比如说IP,ARP等,例子里面是IP

**6)IP模块处理**

收到数据包后也判断是否IP地址符合,然后根据首部协议,发给对应的模块

**7)TCP模块的处理**

首先检查**检验和**(不懂),判断数据是否被破坏,然后检查是否按照序号接收数据,检查端口号,确定具体的应用程序,

数据被完整接收后,就传给端口对应的应用程序

**8)应用程序处理**

接收到数据,通过解析数据,展示给用户



## 3 TCP

TCP提供面向连接的通信传输,意思是在数据进行通信之前,要做好两端的连接准备

### 三次握手

所谓三次握手就是客户端与服务器短确认连接的一个过程,双方一共会发三个包确认连接的建立.

![image-20200424135123347](/home/user/.config/Typora/typora-user-images/image-20200424135123347.png)

**第一次握手**:客户端标志位SYN为1,随机产生一个seq=J,将该数据值发送给服务器端,客户端进入SYN_SENT状态.

**第二次握手**:针对与客户端的请求,服务器端标志位SYN=1,ACK=1表示前面是有效的请求,再令ack=J+1,seq=K,

**第三次握手**:针对于服务器端的SYN确认应答,检测ACK=1,如果是就成功,发送最后一次请求,两边都进入ESTABLISHED状态

服务器跟客户端之间就建立好了联系,可以进行通信.

### 四次挥手

挥手就是一个断开连接的问题,因为TCP是一个两边的问题,因此,在客户端和服务短都需要发送FIN,执行关闭

断开一个TCP连接的时候,需要客户端和服务器端一共发送4个包来确认连接的断开.

![image-20200424141500664](/home/user/.config/Typora/typora-user-images/image-20200424141500664.png)

**第一次挥手**:客户端发一个FIN,用来关闭客户端到服务端的数据传送,客户端进入WAIT状态.意思是"我没有数据发送了,但是你要是还要发给我数据的话,你可以继续发".

**第二次挥手**:服务器端收到FIN后,先发送一个ack,意思是告诉客户端,你的请求我收到了,但是我还没有准备好,请继续等待.于是客户端继续等待服务器的报文

**第三次挥手**:服务器确定数据已经发完毕的时候,就向客户端发动FIN报文,意思是"好了我这边数据发完了,准备好释放连接了"

**第四次挥手**:客户端收到FIN报文后,再确认一次,发送ACK,如果服务器端收到了,那么就可以关闭连接了,完成.

**一些数据**:

**确认号 ack**:应当是字节顺序号+1,只有ACK=1的时候有效,

**顺序号 seq**:用来识别从TCP源端向目的端发送的数据字节流,表示在这个报文段电脑中第一个数据字节的顺序号.

**控制位**:ACK为1的时候,表示确认号有效,0则表示报文中不含确认信息

**SYN**,为1表示连接请求

**FIN,**为1表示释放连接请求

校验和:是对整个TCP报文计算所得,由发送端计算和存储,由接收端进行验证.